<!DOCTYPE html>
<html lang="de">

<head>
    {% if gtm_id %}
    <!-- Google Tag Manager Consent Mode -->
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }

        // Default consent status
        if (!localStorage.getItem('cookie_consent')) {
            gtag('consent', 'default', {
                'analytics_storage': 'denied',
                'ad_storage': 'denied',
                'wait_for_update': 500
            });
        } else {
            const consent = JSON.parse(localStorage.getItem('cookie_consent'));
            gtag('consent', 'default', {
                'analytics_storage': consent.analytics ? 'granted' : 'denied',
                'ad_storage': consent.ads ? 'granted' : 'denied'
            });
        }
    </script>

    <!-- Google Tag Manager -->
    <script>(function (w, d, s, l, i) {
            w[l] = w[l] || []; w[l].push({
                'gtm.start':
                    new Date().getTime(), event: 'gtm.js'
            }); var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
                    'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', '{{ gtm_id }}');</script>
    <!-- End Google Tag Manager -->
    {% endif %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="description"
        content="Classly - Die einfachste Art, deine Schulklasse zu organisieren. Stundenplan, Hausaufgaben und Termine an einem Ort.">
    <meta name="keywords" content="Classly, Schule, Organisation, Stundenplan, Hausaufgaben, Termine, Klasse">
    <meta property="og:title" content="Classly - Klassenorganisation leicht gemacht">
    <meta property="og:description"
        content="Organisiere deine Klasse effizient mit Classly. Alle wichtigen Infos auf einen Blick.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://classly.site/">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#ffffff">
    <title>{% block title %}Classly{% endblock %}</title>
    <script src="https://unpkg.com/htmx.org@2.0.4"></script>
    <link rel="stylesheet" href="/static/styles.css?v=4">
</head>

<body>
    {% if gtm_id %}
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id={{ gtm_id }}" height="0" width="0"
            style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    {% endif %}
    <main class="{% block main_class %}container{% endblock %}">
        {% block content %}{% endblock %}
    </main>
    <footer style="margin-top: 3rem; padding-bottom: 2rem; text-align: center; font-size: 0.85rem; color: #999;">
        <a href="/impressum" style="color: inherit; text-decoration: none; margin: 0 0.5rem;">Impressum</a>
        &bull;
        <a href="/datenschutz" style="color: inherit; text-decoration: none; margin: 0 0.5rem;">Datenschutz</a>
        &bull;
        <a href="https://info.classly.site/status/classly-info" target="_blank"
            style="color: inherit; text-decoration: none; margin: 0 0.5rem;">Status</a>
    </footer>

    {% if gtm_id %}
    <!-- Cookie Consent Banner -->
    <div id="cookie-banner"
        style="display: none; position: fixed; bottom: 20px; left: 20px; right: 20px; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); color: #333; padding: 20px; border-radius: 16px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); border: 1px solid rgba(0,0,0,0.05); z-index: 9999; max-width: 500px; margin: 0 auto;">
        <div style="font-weight: 600; font-size: 1.1rem; margin-bottom: 10px;">Cookies & Datenschutz</div>
        <p style="font-size: 0.9rem; line-height: 1.4; margin-bottom: 20px; color: #666;">
            Wir nutzen Cookies, um die Nutzererfahrung zu verbessern und die Seitennutzung zu analysieren. Mit Klick auf
            "Alle akzeptieren" stimmst du der Verwendung von Analyse-Cookies zu.
        </p>
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <button onclick="acceptAllCookies()"
                style="background: #000; color: #fff; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; flex: 1; transition: opacity 0.2s;">Alle
                akzeptieren</button>
            <button onclick="rejectAllCookies()"
                style="background: #f0f0f0; color: #333; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; flex: 1; transition: background 0.2s;">Ablehnen</button>
        </div>
    </div>

    <script>
        function updateGTMConsent(granted) {
            gtag('consent', 'update', {
                'analytics_storage': granted ? 'granted' : 'denied'
            });
        }

        function acceptAllCookies() {
            const consent = { analytics: true, ads: false, date: new Date().toISOString() };
            localStorage.setItem('cookie_consent', JSON.stringify(consent));
            updateGTMConsent(true);
            document.getElementById('cookie-banner').style.display = 'none';
        }

        function rejectAllCookies() {
            const consent = { analytics: false, ads: false, date: new Date().toISOString() };
            localStorage.setItem('cookie_consent', JSON.stringify(consent));
            updateGTMConsent(false);
            document.getElementById('cookie-banner').style.display = 'none';
        }

        document.addEventListener('DOMContentLoaded', function () {
            if (!localStorage.getItem('cookie_consent')) {
                document.getElementById('cookie-banner').style.display = 'block';
            }
        });
    </script>
    {% endif %}
</body>

</html>